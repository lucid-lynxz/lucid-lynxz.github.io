<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-åº”è¯¥ä»API15è¿˜æ˜¯14å¼€å§‹æ”¯æŒ-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/24/%E5%BA%94%E8%AF%A5%E4%BB%8EAPI15%E8%BF%98%E6%98%AF14%E5%BC%80%E5%A7%8B%E6%94%AF%E6%8C%81-md/" class="article-date">
  <time datetime="2020-10-24T02:43:07.000Z" itemprop="datePublished">2020-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/24/%E5%BA%94%E8%AF%A5%E4%BB%8EAPI15%E8%BF%98%E6%98%AF14%E5%BC%80%E5%A7%8B%E6%94%AF%E6%8C%81-md/">åº”è¯¥ä»API15è¿˜æ˜¯14å¼€å§‹æ”¯æŒ.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>ä¹‹å‰åœ¨ <a target="_blank" rel="noopener" href="https://juejin.im/post/6844903542130475022">æ˜é‡‘</a> å‘å¸ƒè¿‡, é‡æ–°æŠ˜è…¾äº†åŠ  github page, å¤‡ä»½ä¸€ä»½åœ¨è¿™é‡Œ</p>
</blockquote>
<blockquote>
<p>ä¹‹å‰åšäº†ä¸ªåº“, ç”¨æˆ·é›†æˆçš„æ—¶å€™é—®äº†å¥: æˆ‘ä»¬APPæ˜¯ä» <code>Android 4.0.0</code> å¼€å§‹æ”¯æŒçš„, ä½ ä»¬èƒ½ä¸èƒ½æŠŠ <code>minSdkVersion</code> é™åˆ° <code>14</code> (åº“è®¾å®šæ˜¯ <code>15</code> , å¯¹åº”: <code>Android 4.0.3</code> )?  è¿™æ˜¯é—®é¢˜çš„ç”±æ¥,é—²ç€æ²¡äº‹, å°±æ¥ç¨å¾®é’»ä¸€ä¸‹ç‰›è§’å°–,ç ”ç©¶çœ‹çœ‹</p>
</blockquote>
<p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/minSdkVersion15_or_14.png?raw=true" alt="ç”©ä¸ªå¤§çº²å…ˆ"></p>
<h2 id="1-å®˜æ–¹æ¨èçš„æœ€ä½ç‰ˆæœ¬æ”¯æŒ"><a href="#1-å®˜æ–¹æ¨èçš„æœ€ä½ç‰ˆæœ¬æ”¯æŒ" class="headerlink" title="1. å®˜æ–¹æ¨èçš„æœ€ä½ç‰ˆæœ¬æ”¯æŒ"></a>1. å®˜æ–¹æ¨èçš„æœ€ä½ç‰ˆæœ¬æ”¯æŒ</h2><p>å½“åˆåšåº“çš„æ—¶å€™, <code>Android Studio</code>(ç®€ç§° <code>AS</code> )è¿˜æ˜¯æ¨èçš„ <code>API 15</code> , ç°åœ¨(AS 3.0)å·²ç»æ¢æˆäº† <code>API 18</code> :</p>
<p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/as_default.png?raw=true" alt="AS3.0_default.png"></p>
<p>ä¸è¿‡çœ‹ä¸Šé¢å†™çš„æ•°æ®, <code>API 18</code> å¤§æ¦‚åªè¦†ç›–äº† <code>91.4%</code> ,ä¼°è®¡åº”è¯¥å¾ˆå¤šå‚å•†ä¸æ„¿æ„å§, æ¼æ‰äº†å¾ˆå¤šè®¾å¤‡, é‚£ä¸åŒAPIç‰ˆæœ¬çš„è¦†ç›–ç‡æ˜¯å¤šå°‘å‘¢? <code>AS</code> ä¹Ÿç»™å‡ºäº†è‡ªå·±çš„ç»Ÿè®¡:</p>
<p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/as_distribution.png?raw=true" alt="Distribution.png"></p>
<p>ä¸è¿‡è¿™ä¸Šé¢çš„ä¿¡æ¯ä½¿ç”¨  <code>API 15</code> ä»£è¡¨  <code>Android 4.0</code> , æ²¡æœ‰ç»†åˆ† <code>4.0.0 ~ 4.0.3</code> , å¯èƒ½è°·æ­Œè‡ªå·±è§‰å¾—æ²¡å¿…è¦äº†å§, ä¸è¿‡æˆ‘ä»¬ä¾ç„¶å¯ä»¥çœ‹å‡ºä¸€äº›ä¿¡æ¯: <br><br>è‹¥æ˜¯ä» <code>API 16</code> å¼€å§‹æ”¯æŒçš„è¯,è‡³å°‘èƒ½è¦†ç›– <code>99.2%</code> ä»¥ä¸Šçš„è®¾å¤‡äº†;</p>
<h2 id="2-å„ç‰ˆæœ¬ç»Ÿè®¡è¯¦æƒ…ä¿¡æ¯"><a href="#2-å„ç‰ˆæœ¬ç»Ÿè®¡è¯¦æƒ…ä¿¡æ¯" class="headerlink" title="2. å„ç‰ˆæœ¬ç»Ÿè®¡è¯¦æƒ…ä¿¡æ¯"></a>2. å„ç‰ˆæœ¬ç»Ÿè®¡è¯¦æƒ…ä¿¡æ¯</h2><p>é€šå¸¸æˆ‘ä»¬è®¾å®š <code>minSdkVersion</code> æ˜¯çœ‹ç‰ˆæœ¬åˆ†å¸ƒæƒ…å†µçš„,  æ—¢ç„¶ <code>AS</code> æ²¡æ³•æä¾›æ›´ç»†åˆ†ç‰ˆæœ¬çš„åˆ†å¸ƒæ•°æ®,é‚£æˆ‘ä»¬å°±åªèƒ½æ‰¾æ‰¾å…¶ä»–ç»Ÿè®¡æ•°æ®äº†:</p>
<h3 id="1-è°·æ­Œç»Ÿè®¡æ•°æ®"><a href="#1-è°·æ­Œç»Ÿè®¡æ•°æ®" class="headerlink" title="1. è°·æ­Œç»Ÿè®¡æ•°æ®"></a>1. <a target="_blank" rel="noopener" href="https://developer.android.com/about/dashboards/index.html">è°·æ­Œç»Ÿè®¡æ•°æ®</a></h3><p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/google_distribution.png?raw=true" alt="google_analysis_version_distribution"></p>
<h3 id="2-è…¾è®¯ç§»åŠ¨åˆ†æ"><a href="#2-è…¾è®¯ç§»åŠ¨åˆ†æ" class="headerlink" title="2. è…¾è®¯ç§»åŠ¨åˆ†æ"></a>2. <a target="_blank" rel="noopener" href="https://mta.qq.com/mta/data/device/os">è…¾è®¯ç§»åŠ¨åˆ†æ</a></h3><p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/tencent_distribution.png?raw=true" alt="tencent_analysis_version_distribution"></p>
<h3 id="3-å‹ç›Ÿå…¨åŸŸç½—ç›˜"><a href="#3-å‹ç›Ÿå…¨åŸŸç½—ç›˜" class="headerlink" title="3. å‹ç›Ÿå…¨åŸŸç½—ç›˜"></a>3. <a target="_blank" rel="noopener" href="http://compass.umeng.com/#/equipment?_k=k56hy5">å‹ç›Ÿå…¨åŸŸç½—ç›˜</a></h3><p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/umeng_distribution.png?raw=true" alt="è¡¨æ ¼ä¸­çš„é‚£æ¡ç³»ç»Ÿ `9.1` çš„æ•°æ®æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯ä»€ä¹ˆé¬¼,åˆ«é—®æˆ‘:"></p>
<p>æ€»ç»“:<br>ä»ä»¥ä¸Šä¸‰ä»½æ•°æ®ç»Ÿè®¡æ¥çœ‹, <code>API 14(Andorid 4.0.0~4.0.2)</code> éƒ½æ²¡æœ‰è¢«ç»Ÿè®¡, çŒœæƒ³æœ‰ä¸¤ç§å¯èƒ½:</p>
<ul>
<li>è®¾å¤‡æ•°è¿‡å°‘(è‡³å°‘ä½äº <code>0.5%</code> ), å› æ­¤æ²¡æœ‰äºˆä»¥è®°å½•;</li>
<li>å¸‚é¢ä¸Šæ²¡æœ‰é‚£ç§è¯¥ç³»ç»Ÿç‰ˆæœ¬çš„æœºå‹,å› æ­¤æ— æ³•ç»Ÿè®¡;</li>
</ul>
<h3 id="3-Android-å„ç³»ç»Ÿç‰ˆæœ¬å‘å¸ƒæ—¶é—´"><a href="#3-Android-å„ç³»ç»Ÿç‰ˆæœ¬å‘å¸ƒæ—¶é—´" class="headerlink" title="3.  Android å„ç³»ç»Ÿç‰ˆæœ¬å‘å¸ƒæ—¶é—´"></a>3. <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Android_version_history"> Android å„ç³»ç»Ÿç‰ˆæœ¬å‘å¸ƒæ—¶é—´</a></h3><p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/android_release_time.png?raw=true" alt="æ›´å¤šè¯¦æƒ…è¯·ç‚¹å‡»ä¸Šæ–¹æ ‡é¢˜é“¾æ¥"></p>
<p>ä»ä¸Šè¡¨å¯ä»¥å‘ç°:</p>
<ul>
<li> <code>4.0.0</code> å‘å¸ƒ <strong>ä»…3å¤©</strong> åå°±å‘å¸ƒäº† <code>4.0.1</code> , <strong>ä¸€ä¸ªæœˆ</strong> åå‘å¸ƒäº† <code>4.0.2</code>ç‰ˆæœ¬,å‡ä¸ºbugä¿®å¤ç‰ˆ;</li>
<li> <code>4.0.3</code> æ˜¯ä¿®å¤äº†å¤§é‡bugå’Œä¼˜åŒ–åå‘å¸ƒçš„ç¨³å®šç‰ˆ:<br>åŸºæœ¬ä¸Šå¯ä»¥è‚¯å®š <code>4.0.0</code> æ˜¯ä¸ä¼šæœ‰æœºå‹å‘å¸ƒçš„,æœ€å¤§çš„å¯èƒ½ä¹Ÿæ˜¯ <code>4.0.2</code>,è¿™ä¸ªæˆ‘ä»¬åé¢ç»§ç»­éªŒè¯;</li>
</ul>
<h2 id="4-æ‰‹æœºå‚å•†å‡ºæœºæ—¶é—´"><a href="#4-æ‰‹æœºå‚å•†å‡ºæœºæ—¶é—´" class="headerlink" title="4. æ‰‹æœºå‚å•†å‡ºæœºæ—¶é—´"></a>4. æ‰‹æœºå‚å•†å‡ºæœºæ—¶é—´</h2><p>ä¸æ‰“ç®—æ‰¾é‚£ä¹ˆå¤šå®¶çš„ä¿¡æ¯äº†,æˆ‘ä»¬çœ‹çœ‹å½“å¹´æ¯”è¾ƒç«çš„ htc/å°ç±³ çš„æƒ…å†µå°±å¥½:</p>
<ul>
<li><p><code>2011.10.18</code>  <code>Android 4.0.0</code> å‘å¸ƒ, è€Œ <a target="_blank" rel="noopener" href="http://tech.sina.com.cn/mobile/models/12693/detail.shtml">å°ç±³1s</a>  <code>2012.8</code> å‘å¸ƒæ—¶,åŸºäºçš„è¿˜æ˜¯ <code>Android 2.3</code>;</p>
</li>
<li><p><code>2012.3</code> å‘å¸ƒçš„ <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Y7t2JU2RP80">HTC One X</a> åŸºäº <code>Android 4.0.3</code><br>ä» <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/HTC_Sense#Sense_3.6_.282012.29">ç»´åŸºç™¾ç§‘</a> ä¸Šå¯ä»¥çœ‹åˆ° <code>HTC Sence 3.6</code> æ˜¯HTCç¬¬ä¸€ç‰ˆåŸºäº <code>Android 4.0</code> å¼€å‘çš„å®šåˆ¶rom,  è€Œä» <a target="_blank" rel="noopener" href="http://www.miui.com/thread-477953-1-1.html">è¿™é‡Œ</a> å’Œ <a target="_blank" rel="noopener" href="https://www.engadget.com/2012/03/13/htc-sense-3-6-preview/">è¿™é‡Œ</a> å¯ä»¥ç¡®è®¤: å…¶åŸºäºçš„æ˜¯ <code>4.0.3</code>, å³ HTCå®šåˆ¶ROMä¹Ÿæ²¡æœ‰ <code>4.0.0~4.0.2</code> çš„ç‰ˆæœ¬;</p>
</li>
<li><p>å†æ¥çœ‹çœ‹è°·æ­Œè‡ªå·±çš„æƒ…å†µ<br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Android_version_history#Android_8.0_Oreo_.28API_26.29">Android 8.0</a>  äº <code>2017.8</code> å‘å¸ƒ, è€Œè°·æ­Œè‡ªå·±çš„å½“å‰æ——èˆ°æœº <a target="_blank" rel="noopener" href="https://developers.google.com/android/images">pixel 2xl</a> äº <code>2017.9</code> æ‰æä¾› <code>factory image</code> ä¸‹è½½, å…¶ä»–æœºå‹æ›´æ™š;<br>åŸºäºä»¥ä¸Šæƒ…å†µ,å¯å¤§èƒ†æ¨æ–­: <code>Android 4.0.0~4.0.2</code> æ˜¯æ²¡æœ‰æœºå‹å‘å¸ƒçš„, åœ¨çŸ­çŸ­ä¸€ä¸ªæœˆçš„æ—¶é—´å†…, romå‚å•†å¯èƒ½éƒ½æ¥ä¸åŠè·å–å®šåˆ¶å§;</p>
</li>
</ul>
<h2 id="5-åº”ç”¨å¸‚åœºä¸Šçš„åº”ç”¨æ”¯æŒæƒ…å†µ"><a href="#5-åº”ç”¨å¸‚åœºä¸Šçš„åº”ç”¨æ”¯æŒæƒ…å†µ" class="headerlink" title="5. åº”ç”¨å¸‚åœºä¸Šçš„åº”ç”¨æ”¯æŒæƒ…å†µ"></a>5. åº”ç”¨å¸‚åœºä¸Šçš„åº”ç”¨æ”¯æŒæƒ…å†µ</h2><p>åŸæœ¬ä»¥ä¸ºä¸å­˜åœ¨è¯¥ç‰ˆæœ¬çš„æœºå‹,é‚£å¸‚é¢ä¸Šçš„APPåº”è¯¥å¾ˆå°‘ä¼šä» <code>API 14</code> å¼€å§‹æ”¯æŒçš„, ä¸ºäº†éªŒè¯æƒ³æ³•, æˆ‘å»ä¸‹äº†åº”ç”¨å®çš„å‰100åº”ç”¨(P.S. ä¹‹æ‰€ä»¥æ˜¯åº”ç”¨å®è€Œä¸æ˜¯å…¶ä»–å¸‚åœº,æ˜¯å› ä¸ºå®ƒæœ‰æ¥å£å¯ä»¥ç›´æ¥è°ƒç”¨,æ‡’å¾—çˆ¬äº†ğŸ˜), è„šæœ¬åœ°å€åœ¨ <a target="_blank" rel="noopener" href="https://github.com/lucid-lynxz/PythonDemos/tree/master/qq_market_analysis">è¿™é‡Œ</a>, æ‡’å¾—è¿è¡Œçš„è¯å¯ä»¥åˆ°æˆ‘ <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1dEUmj6L">äº‘ç›˜ä¸‹è½½, å¯†ç : icfv</a>; </p>
<p><img src="https://github.com/lucid-lynxz/markdownPhotos/blob/master/android_minsdkversion_research/minsdkversion_statistic.png?raw=true" alt="ç»Ÿè®¡ç»“æœ"></p>
<p>(ãƒ¼ãƒ¼ã‚›)æˆ‘å», å‡ºä¹æˆ‘æ„æ–™çš„æ˜¯ <code>API 14</code> ç«Ÿç„¶å ä¸€åŠ, è°èƒ½å‘Šè¯‰æˆ‘ä¸ºä»€ä¹ˆ?<br>å¦å¤– <code>API 11/12</code> çš„åˆæ˜¯ä»€ä¹ˆé¬¼? æœ‰æ‰‹æœºæ˜¯ <code>Android 3.0</code> çš„å—? æ•æˆ‘å­¤é™‹å¯¡é—»äº†;</p>
<h2 id="6-å°ç»“"><a href="#6-å°ç»“" class="headerlink" title="6. å°ç»“"></a>6. å°ç»“</h2><p>ğŸ˜± æ„Ÿè§‰è‡ªå·±è¢«è‡ªå·±æ‰“è„¸äº†,  ä¸è¿‡æˆ‘ä¾ç„¶åšæŒè‡ªå·±çš„æœ€åˆçœ‹æ³•, è‹¥è¦æ±‚ä» <code>4.0</code> æ”¯æŒ,é‚£ä» <code>4.0.3</code> å¼€å§‹å³å¯, è™½ç„¶ä½ å°† <code>15</code> é™æˆ <code>14</code> å¯¹ä»£ç ä¹Ÿæ²¡å½±å“, ä½†æ„Ÿè§‰æ˜¯åšäº†å¤šä½™çš„äº‹æƒ…, å´éè¦è¯´è‡ªå·±æ”¯æŒæ›´å¤šçš„æœºå­;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/24/%E5%BA%94%E8%AF%A5%E4%BB%8EAPI15%E8%BF%98%E6%98%AF14%E5%BC%80%E5%A7%8B%E6%94%AF%E6%8C%81-md/" data-id="ckgn2xkfu0001qxwd2ul4frlz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-LifeCycleè§£æ-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/24/LifeCycle%E8%A7%A3%E6%9E%90-md/" class="article-date">
  <time datetime="2020-10-24T02:42:12.000Z" itemprop="datePublished">2020-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/24/LifeCycle%E8%A7%A3%E6%9E%90-md/">LifeCycleè§£æ.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<blockquote>
<p>ä¹‹å‰åœ¨ <a target="_blank" rel="noopener" href="https://juejin.im/post/6844903838474993677">æ˜é‡‘</a> å‘å¸ƒè¿‡, é‡æ–°æ•´ç†åœ¨è¿™é‡Œ</p>
</blockquote>
</blockquote>
<blockquote>
<p>ä¹‹å‰ç”¨è¿‡ä¸€äº›androidæ¶æ„ç»„ä»¶,ä½†ä¹Ÿä»…é™äºapiè°ƒç”¨,çŸ¥å…¶ç„¶ä¹Ÿè¯¥çŸ¥å…¶æ‰€ä»¥ç„¶,æ‰€ä»¥å°è¯•äº†è§£ä¸‹å…¶æºç å®ç°,åç»­ä¼šå‡ºlivedata,viewmodelçš„;</p>
<p>æœ¬æ–‡åŸºäº: macOS 10.13/AS 3.3.1/support-v7 28.0.0/lifecycle 1.1.1</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/lucid-lynxz/BlogSamples/tree/master/LifeCycleDemo">demoé¡¹ç›®</a></p>
<h2 id="ä½¿ç”¨æ–¹æ³•ç®€ä»‹"><a href="#ä½¿ç”¨æ–¹æ³•ç®€ä»‹" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ç®€ä»‹"></a>ä½¿ç”¨æ–¹æ³•ç®€ä»‹</h2><p>ä»¥å‰æ‹†åˆ†ä¸šåŠ¡é€»è¾‘åˆ°ç‹¬ç«‹çš„ <code>presenter</code> ä¸­æ—¶,éœ€è¦é‡å†™ <code>Activity</code>/<code>Fragment</code> å„ç”Ÿå‘½å‘¨æœŸ,ç„¶åå‘ŠçŸ¥ <code>presenter</code>, å†™èµ·æ¥éº»çƒ¦, æœ‰æ²¡æœ‰æ¯”è¾ƒç®€å•çš„æ–¹å¼èƒ½æŠŠè¿™äº›â€è„æ´»â€ç»™å¤„ç†æ‰å‘¢?</p>
<p>æˆ‘ä»¬çœ‹çœ‹ <code>Lifecycle</code> æ¶æ„ç»„ä»¶çš„å†™æ³•:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MainActiviy.kt</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line">        <span class="comment">// æ³¨å†Œä¸€ä¸ªObserverå³å¯,ä¸éœ€è¦é‡å†™å„ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line">        lifecycle.addObserver(MainActObserver())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MainActObserver.kt</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActObserver</span> : <span class="type">LifecycleObserver &#123;</span></span></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_CREATE)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Logger.d(<span class="string">&quot;MainActObserver <span class="variable">$this</span> onCreate&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">onResume</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Logger.d(<span class="string">&quot;MainActObserver onResume&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…¶ä»–ç”Ÿå‘½å‘¨æœŸå›è°ƒ,æ­¤å¤„çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å°±ç®€å•ä¸€å¥ <code>lifecycle.addObserver(MainActObserver())</code> å°±å®Œæˆäº† <code>Activity</code> å„ç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬;</p>
<blockquote>
<p>P.S. ç”±äº Android Studio åˆ›å»ºé¡¹ç›®æ—¶é»˜è®¤å¯¼å…¥äº† support çš„ appcompat-v7 åŒ…,å·²ç»æŠŠ Lifecycle ç›¸å…³ä»£ç å¯¼å…¥è¿›æ¥äº†, å› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨,ä¸éœ€è¦é¢å¤–æ·»åŠ ä¾èµ–;</p>
</blockquote>
<p>ä»¥ä¸Šæ˜æ˜¾æ˜¯è§‚å¯Ÿè€…æ¨¡å¼: </p>
<ol>
<li><code>Lifecycle</code> ä½œä¸ºè¢«è§‚å¯Ÿå¯¹è±¡,æŒæœ‰ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ä¿¡æ¯;</li>
<li><code>Activity/Fragment</code> æ˜¯ <code>Lifecycle</code> çš„å®¿ä¸», æŠ½è±¡ä¸º: <code>LifecycleOwner</code>, ä¼šå°†è‡ªèº«ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–å‘ŠçŸ¥ <code>lifecycle</code>, åè€…æ›´æ–°å½“å‰çŠ¶æ€å€¼(<code>State</code>);</li>
<li>åŸ <code>presenter</code> å¯å½“ä½œè§‚å¯Ÿè€…,è®°ä¸º: <code>LifecycleObserver</code>;</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2019/3/3/1694375994eb5ba7?w=912&h=448&f=png&s=39669" alt="lifecycle-observer-mode"></p>
<h2 id="Lifecycle-ç±»è§£æ"><a href="#Lifecycle-ç±»è§£æ" class="headerlink" title="Lifecycle ç±»è§£æ"></a>Lifecycle ç±»è§£æ</h2><p><code>Lifecycle</code> ç±»éœ€è¦å¯¹å„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä½œå‡ºååº”, ç„¶åä¿å­˜å½“å‰å®¿ä¸»çš„çŠ¶æ€,æœ€åé€šçŸ¥å„ <code>Observer</code>:<br>æˆ‘ä»¬çœ‹ä¸‹æºç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lifecycle.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Lifecycle</span> </span>&#123;</span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(<span class="meta">@NonNull</span> LifecycleObserver observer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(<span class="meta">@NonNull</span> LifecycleObserver observer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MainThread</span></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> State <span class="title">getCurrentState</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸäº‹ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">        ON_CREATE, ON_START, ON_RESUME, ON_PAUSE, ON_STOP, ON_DESTROY, ON_ANY</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿå‘½å‘¨æœŸçŠ¶æ€</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä»¥ä¸‹å‡å·² Activity ä¸ºä¾‹,ä»‹ç»å„çŠ¶æ€å€¼,å…·ä½“è¯·çœ‹æºç æ³¨é‡Š</span></span><br><span class="line">        DESTROYED, <span class="comment">// åœ¨ onDestroy() å‰å³è¢«æ ‡è®°ä¸º DESTROYED çŠ¶æ€</span></span><br><span class="line">        INITIALIZED, <span class="comment">// å¯¹è±¡åˆ›å»ºåä½†å°šæœªæ”¶åˆ° onCreate() é€šçŸ¥ä¹‹å‰</span></span><br><span class="line">        CREATED,<span class="comment">// onCreate() ä¹‹å, onStop() ä¹‹å‰</span></span><br><span class="line">        STARTED, <span class="comment">// onStart() ä¹‹å ,onPause() ä¹‹å‰</span></span><br><span class="line">        RESUMED; <span class="comment">// onResume() ä¹‹å</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAtLeast</span><span class="params">(<span class="meta">@NonNull</span> State state)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> compareTo(state) &gt;= <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç° <code>Lifecycle</code> åªæ˜¯ä¸ªæŠ½è±¡ç±»,è€Œä¸”æ²¡æœ‰å¯¹ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–åšå‡ºå“åº”çš„æ–¹æ³•, å› æ­¤åº”è¯¥æœ‰ä¸ªå®ç°ç±»å¯¹ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ä½œå‡ºå¤„ç†;<br>æˆ‘ä»¬é€šè¿‡ AS æä¾› <code>Type Hierarchy</code> åŠŸèƒ½(<code>ctrl+h</code>)å¾—çŸ¥ <code>LifecycleRegistry</code> ç±»,å¹¶å¾—åˆ°å¦‚ä¸‹ç±»å›¾:</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/3/3/169438b857e2addf?w=1640&h=644&f=png&s=120181" alt="lifecycle"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/24/LifeCycle%E8%A7%A3%E6%9E%90-md/" data-id="ckgn2xkfp0000qxwd98sy13s9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-VideoView-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/24/VideoView-md/" class="article-date">
  <time datetime="2020-10-24T02:39:51.000Z" itemprop="datePublished">2020-10-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/24/VideoView-md/">VideoView.md</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>é¡¹ç›®éœ€è¦åšä¸€ä¸ªç®€å•çš„æ’­æ”¾è§†é¢‘åŠŸèƒ½demo,åæœŸä¼šæ¢æˆå…¬å¸è‡ªå·±çš„ç»„ä»¶,æ‰€ä»¥å°±æ²¡è€ƒè™‘ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“äº†,ç›´æ¥ä¸Šç³»ç»Ÿçš„VideoView,åœ¨è¿™é‡Œè®°å½•ä¸‹æ“ä½œ;<br>é¡ºä¾¿åæ§½ä¸‹:ä¸€ç›´éƒ½å¬è¯´ç®€ä¹¦ç¼–è¾‘å™¨å¥½ç”¨,ç¬¬ä¸€æ¬¡ä½¿ç”¨,æœ‰ç‚¹å¤±æœ›,markdownè·Ÿæ•ˆæœåˆ†æ ç«Ÿç„¶ä¸èƒ½åŒæ­¥æ»šåŠ¨,ä¹Ÿä¸æ”¯æŒ[TOC],æ²¡æœ‰ä¸ªç›®å½•å®åœ¨å¾ˆä¸ä¹ æƒ¯,è¡¨æƒ…å›¾æ ‡ä¹Ÿä¸èƒ½æ’å…¥,ä»£ç åŒºå—åŠ ç©ºè¡Œç»å¸¸éƒ½è¯†åˆ«ä¸äº†å•Š,å°±ä¸èƒ½è®©æˆ‘ç®€å•æ»´ä»ç¬”è®°ä¸­ç›´æ¥ç²˜è´´mdæ–‡æœ¬å—â€¦ ==!</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/lucid-lynxz/BlogSamples/tree/master/VideoViewDemo">Demoé¡¹ç›®ä¸‹è½½</a><br><a target="_blank" rel="noopener" href="https://github.com/lucid-lynxz/ZZVideoPlayer">è‡ªå·±å°è£…äº†ä¸€ä¸ªæ’­æ”¾å™¨</a></p>
<h2 id="èµ„æº"><a href="#èµ„æº" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><ol>
<li><a target="_blank" rel="noopener" href="http://itindex.net/detail/35521-android-%E6%92%AD%E6%94%BE-%E8%A7%86%E9%A2%91">Androidä¸‰ç§æ’­æ”¾è§†é¢‘çš„æ–¹å¼</a></li>
<li><a target="_blank" rel="noopener" href="http://www.mikewootc.com/wiki/android/mid/mediaplayer_awesome.html">Androidæ’­æ”¾å™¨æ¡†æ¶åˆ†æä¹‹AwesomePlayer</a></li>
<li><a target="_blank" rel="noopener" href="http://www.bkjia.com/Androidjc/1110895.html">éŸ³é¢‘ä¸è§†é¢‘æ’­æ”¾</a> è®²çš„playerç±»,æ¯”è¾ƒå…¨</li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/u010072711/article/details/51517170">Androidè§†é¢‘æ’­æ”¾å™¨å®ç°å°çª—å£å’Œå…¨å±çŠ¶æ€åˆ‡æ¢</a></li>
</ol>
<blockquote>
<p>è§†é¢‘æ’­æ”¾åŸç†:<br>ç³»ç»Ÿä¼šé¦–å…ˆç¡®å®šè§†é¢‘çš„æ ¼å¼ï¼Œç„¶åå¾—åˆ°è§†é¢‘çš„ç¼–ç ..ç„¶åå¯¹ç¼–ç è¿›è¡Œè§£ç ï¼Œå¾—åˆ°ä¸€å¸§ä¸€å¸§çš„å›¾åƒï¼Œæœ€ååœ¨ç”»å¸ƒä¸Šè¿›è¡Œè¿…é€Ÿæ›´æ–°,æ˜¾ç„¶éœ€è¦åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­å®Œæˆ,è¿™æ—¶å°±éœ€è¦ä½¿ç”¨surfaceViewäº†</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://developer.android.com/intl/zh-cn/guide/appendix/media-formats.html#core">android æ”¯æŒçš„ç¼–ç æ ¼å¼</a><br><img src="https://user-gold-cdn.xitu.io/2017/12/27/16096ad67f6d3007?w=994&h=606&f=png&s=44312" alt="android_video_support_format.png"></p>
<h2 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">VideoView mVv = (VideoView) findViewById(R.id.vv);</span><br><span class="line"><span class="comment">//æ·»åŠ æ’­æ”¾æ§åˆ¶æ¡,è¿˜æ˜¯è‡ªå®šä¹‰å¥½ç‚¹</span></span><br><span class="line">mVv.setMediaController(<span class="keyword">new</span> MediaController(<span class="keyword">this</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®è§†é¢‘æºæ’­æ”¾res/rawä¸­çš„æ–‡ä»¶,æ–‡ä»¶åå°å†™å­—æ¯,æ ¼å¼: 3gp,mp4ç­‰,flvçš„ä¸ä¸€å®šæ”¯æŒ;</span></span><br><span class="line">Uri rawUri = Uri.parse(<span class="string">&quot;android.resource://&quot;</span> + getPackageName() + <span class="string">&quot;/&quot;</span> + R.raw.shuai_dan_ge);</span><br><span class="line">mVv.setVideoURI(rawUri);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’­æ”¾åœ¨çº¿è§†é¢‘</span></span><br><span class="line">mVideoUri = Uri.parse(<span class="string">&quot;http://****/abc.mp4&quot;</span>);</span><br><span class="line">mVv.setVideoPath(mVideoUri.toString());</span><br><span class="line"></span><br><span class="line">mVv.start();</span><br><span class="line">mVv.requestFocus();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å…¶ä»–æ–¹æ³•:</span></span><br><span class="line"><span class="comment">mVv.pause();</span></span><br><span class="line"><span class="comment">mVv.stop();</span></span><br><span class="line"><span class="comment">mVv.resume();</span></span><br><span class="line"><span class="comment">mVv.setOnPreparedListener(this);</span></span><br><span class="line"><span class="comment">mVv.setOnErrorListener(this);</span></span><br><span class="line"><span class="comment">mVv.setOnCompletionListener(this);**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Errorä¿¡æ¯å¤„ç† :</span></span><br><span class="line"><span class="comment">ç»å¸¸ä¼šç¢°åˆ°è§†é¢‘ç¼–ç æ ¼å¼ä¸æ”¯æŒçš„æƒ…å†µ,è¿™é‡Œè¿˜æ˜¯å¤„ç†ä¸€ä¸‹,è‹¥ä¸æƒ³å¼¹å‡ºæç¤ºæ¡†å°±è¿”å›true;</span></span><br><span class="line"><span class="comment">http://developer.android.com/intl/zh-cn/reference/android/media/MediaPlayer.OnErrorListener.html</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">@Override </span></span><br><span class="line"><span class="comment">public boolean onError(MediaPlayer mp, int what, int extra) &#123; </span></span><br><span class="line"><span class="comment">   if(what==MediaPlayer.MEDIA_ERROR_SERVER_DIED)&#123; </span></span><br><span class="line"><span class="comment">        Log.v(TAG,&quot;Media Error,Server Died&quot;+extra); </span></span><br><span class="line"><span class="comment">   &#125;else if(what==MediaPlayer.MEDIA_ERROR_UNKNOWN)&#123; </span></span><br><span class="line"><span class="comment">        Log.v(TAG,&quot;Media Error,Error Unknown &quot;+extra); </span></span><br><span class="line"><span class="comment">   &#125; </span></span><br><span class="line"><span class="comment">return true; </span></span><br><span class="line"><span class="comment">&#125; </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="é”™è¯¯ä¿¡æ¯"><a href="#é”™è¯¯ä¿¡æ¯" class="headerlink" title="é”™è¯¯ä¿¡æ¯"></a>é”™è¯¯ä¿¡æ¯</h3><p><a target="_blank" rel="noopener" href="https://github.com/fallowu/slim_hardware_qcom_media/blob/master/QCMediaPlayer/com/qualcomm/qcmedia/QCMediaPlayer.java">QCMediaPlayer.java</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//å¸¸è§é”™è¯¯: &quot;æ— æ³•æ’­æ”¾æ­¤è§†é¢‘&quot; -æˆ‘æµ‹è¯•çš„æ˜¯:çº¢ç±³1sç”µä¿¡ç‰ˆ4.4.4æ— æ³•æ’­æ”¾,ä½†åœ¨ä¸‰æ˜Ÿs6ï¼ˆ5.1.1ï¼‰ä¸Šå°±å¯ä»¥æ’­æ”¾</span><br><span class="line">//æ’­æ”¾æº:http://27.152.191.198/c12.e.99.com/b/p/67/c4ff9f6535ac41a598bb05bf5b05b185/c4ff9f6535ac41a598bb05bf5b05b185.v.854.480.f4v</span><br><span class="line">MediaPlayer-JNI: QCMediaPlayer mediaplayer NOT present</span><br><span class="line">MediaPlayer: Unable to create media player</span><br><span class="line">MediaPlayer: Couldn&#x27;t open file on client side, trying server side</span><br><span class="line">MediaPlayer: error (1, -2147483648)</span><br><span class="line">MediaPlayer: Error (1,-2147483648)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/24501086/why-mediaplayer-throws-not-present-error-when-creating-instance-of-it">æœ‰äººè¯´</a> ç”¨ä¸‹é¢çš„æ–¹å¼å¯ä»¥å¤„ç†è¯¥å¼‚å¸¸,ä½†æˆ‘æ˜¯ä½¿ç”¨ç³»ç»Ÿå°è£…å¥½çš„æ§ä»¶,è¿™ä¸ªæ“ä½œä¸åˆ°å§? å…ˆè®°å½•ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MediaPlayer player = MediaPlayer.create(<span class="keyword">this</span>, Uri.parse(sound_file_path));</span><br><span class="line">MediaPlayer player = MediaPlayer.create(<span class="keyword">this</span>, soundRedId, loop);</span><br></pre></td></tr></table></figure>

<h2 id="å…¨å±æ’­æ”¾-æ¨ªç«–å±åˆ‡æ¢"><a href="#å…¨å±æ’­æ”¾-æ¨ªç«–å±åˆ‡æ¢" class="headerlink" title="å…¨å±æ’­æ”¾ - æ¨ªç«–å±åˆ‡æ¢"></a>å…¨å±æ’­æ”¾ - æ¨ªç«–å±åˆ‡æ¢</h2><ul>
<li><p><code>androidmanifest.xml</code> ä¸­ä¾ç„¶è¿˜æ˜¯å®šä¹‰ç«–å±,å¹¶å®šä¹‰ä¸€ä¸ªåˆ‡æ¢æ¨ªçºµå±æŒ‰é’® <code>btnChange</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;lynxz.org.video.VideoActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:configChanges</span>=<span class="string">&quot;keyboard|orientation|screenSize&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:screenOrientation</span>=<span class="string">&quot;portrait&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:theme</span>=<span class="string">&quot;@style/Theme.AppCompat.Light.NoActionBar&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¸ƒå±€:éœ€è¦åœ¨ <code>VidioView</code> å¤–å±‚å¥—ä¸€ä¸ªå®¹å™¨,æ¯”å¦‚:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/rl_vv&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">&quot;@android:color/black&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:minHeight</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:visibility</span>=<span class="string">&quot;visible&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">VideoView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/vv&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¹ˆåšæ˜¯ä¸ºäº†åœ¨åˆ‡æ¢å±å¹•æ–¹å‘çš„æ—¶å€™å¯¹ <code>rl_vv</code> è¿›è¡Œæ‹‰ä¼¸,è€Œå†…éƒ¨çš„ <code>VideoView</code> ä¼šä¾æ®è§†é¢‘å°ºå¯¸é‡æ–°è®¡ç®—å®½é«˜,æˆ‘ä»¬çœ‹çœ‹å…¶ <code>onMeasure()</code> æºç å°±æ˜äº†äº†,ä½†è‹¥æ˜¯ç›´æ¥å…·ä½“æŒ‡å®šäº†viewçš„å®½é«˜,åˆ™è§†é¢‘ä¼šè¢«æ‹‰ä¼¸:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//VideoView.java </span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> width = getDefaultSize(mVideoWidth, widthMeasureSpec);</span><br><span class="line">    <span class="keyword">int</span> height = getDefaultSize(mVideoHeight, heightMeasureSpec);</span><br><span class="line">    ......</span><br><span class="line">    setMeasuredDimension(width, height);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>æŒ‰é’®ç›‘å¬,æ‰‹åŠ¨åˆ‡æ¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">btnSwitch.setOnClickListener(View -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (getRequestedOrientation() == ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE) &#123;</span><br><span class="line">        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®VideoViewå¸ƒå±€å°ºå¯¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConfigurationChanged</span><span class="params">(Configuration newConfig)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onConfigurationChanged(newConfig);</span><br><span class="line">    <span class="keyword">if</span> (mVv == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE)&#123;<span class="comment">//æ¨ªå±</span></span><br><span class="line">        getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);</span><br><span class="line">        getWindow().getDecorView().invalidate();</span><br><span class="line">        <span class="keyword">float</span> height = DensityUtil.getWidthInPx(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">float</span> width = DensityUtil.getHeightInPx(<span class="keyword">this</span>);</span><br><span class="line">        mRlVv.getLayoutParams().height = (<span class="keyword">int</span>) width;</span><br><span class="line">        mRlVv.getLayoutParams().width = (<span class="keyword">int</span>) height;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> WindowManager.LayoutParams attrs = getWindow().getAttributes();</span><br><span class="line">        attrs.flags &amp;= (~WindowManager.LayoutParams.FLAG_FULLSCREEN);</span><br><span class="line">        getWindow().setAttributes(attrs);</span><br><span class="line">        getWindow().clearFlags(WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS);</span><br><span class="line">        <span class="keyword">float</span> width = DensityUtil.getWidthInPx(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">float</span> height = DensityUtil.dip2px(<span class="keyword">this</span>, <span class="number">200.f</span>);</span><br><span class="line">        mRlVv.getLayoutParams().height = (<span class="keyword">int</span>) height;</span><br><span class="line">        mRlVv.getLayoutParams().width = (<span class="keyword">int</span>) width;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰å·¥å…·ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DensityUtil.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getHeightInPx</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">float</span> height = context.getResources().getDisplayMetrics().heightPixels;</span><br><span class="line">	<span class="keyword">return</span> height;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> <span class="title">getWidthInPx</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">final</span> <span class="keyword">float</span> width = context.getResources().getDisplayMetrics().widthPixels;</span><br><span class="line">	<span class="keyword">return</span> width;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–,å¦‚æœæ˜¯å°†æ’­æ”¾å™¨æ”¾äºfragmentä¸­è¿›è¡Œæ¨ªç«–å±åˆ‡æ¢,åˆ™éœ€è¦åœ¨onCreateViewä¸­<code>setRetainInstance(true);</code>,è¿™æ ·æ—‹è½¬å,æ‰ä¸ä¼šé‡æ–°åˆ›å»ºä»å¤´å¼€å§‹æ’­æ”¾;</p>
</li>
</ul>
<h2 id="è·å–ç¬¬ä¸€å¸§çš„å†…å®¹ä½œä¸ºå°é¢"><a href="#è·å–ç¬¬ä¸€å¸§çš„å†…å®¹ä½œä¸ºå°é¢" class="headerlink" title="è·å–ç¬¬ä¸€å¸§çš„å†…å®¹ä½œä¸ºå°é¢"></a>è·å–ç¬¬ä¸€å¸§çš„å†…å®¹ä½œä¸ºå°é¢</h2><p><a target="_blank" rel="noopener" href="http://www.cnblogs.com/yydcdut/p/4222913.html">å‚è€ƒæ–‡ç« </a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TargetApi(Build.VERSION_CODES.ICE_CREAM_SANDWICH)</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createVideoThumbnail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Observable&lt;Bitmap&gt; observable = Observable.create(<span class="keyword">new</span> Observable.OnSubscribe&lt;Bitmap&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> Bitmap&gt; subscriber)</span> </span>&#123;</span><br><span class="line">            Bitmap bitmap = <span class="keyword">null</span>;</span><br><span class="line">            MediaMetadataRetriever retriever = <span class="keyword">new</span> MediaMetadataRetriever();</span><br><span class="line">            <span class="keyword">int</span> kind = MediaStore.Video.Thumbnails.MINI_KIND;</span><br><span class="line">            <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">14</span>) &#123;</span><br><span class="line">                retriever.setDataSource(mVideoUrl, <span class="keyword">new</span> HashMap&lt;String, String&gt;());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                retriever.setDataSource(mVideoUrl);</span><br><span class="line">            &#125;</span><br><span class="line">            bitmap = retriever.getFrameAtTime();</span><br><span class="line">            subscriber.onNext(bitmap);</span><br><span class="line">            retriever.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">observable.observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        .subscribeOn(Schedulers.io())</span><br><span class="line">        .subscribe(<span class="keyword">new</span> Action1&lt;Bitmap&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Bitmap bitmap)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//è®¾ç½®å°é¢</span></span><br><span class="line">                mYourVideoPlayerContainer.setBackgroundDrawable(<span class="keyword">new</span> BitmapDrawable(bitmap));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ»‘åŠ¨æ”¹å˜å±å¹•äº®åº¦-éŸ³é‡"><a href="#æ»‘åŠ¨æ”¹å˜å±å¹•äº®åº¦-éŸ³é‡" class="headerlink" title="æ»‘åŠ¨æ”¹å˜å±å¹•äº®åº¦/éŸ³é‡"></a>æ»‘åŠ¨æ”¹å˜å±å¹•äº®åº¦/éŸ³é‡</h2><ul>
<li><p>æƒé™ç”³è¯·</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_SETTINGS&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.VIBRATE&quot;</span>/&gt;</span> //æŒ‰éœ€ç”³è¯·</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹äº®åº¦æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*è®¾ç½®å½“å‰å±å¹•äº®åº¦å€¼ 0--255ï¼Œå¹¶ä½¿ä¹‹ç”Ÿæ•ˆ*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setScreenBrightness</span><span class="params">(<span class="keyword">float</span> value)</span> </span>&#123;</span><br><span class="line">    WindowManager.LayoutParams lp = getWindow().getAttributes();</span><br><span class="line">    lp.screenBrightness = lp.screenBrightness + value / <span class="number">255.0f</span>;</span><br><span class="line">    Vibrator vibrator;</span><br><span class="line">    <span class="keyword">if</span> (lp.screenBrightness &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        lp.screenBrightness = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//              vibrator = (Vibrator) getSystemService(VIBRATOR_SERVICE);</span></span><br><span class="line">        <span class="comment">//              long[] pattern = &#123;10, 200&#125;; // OFF/ON/OFF/ON...</span></span><br><span class="line">        <span class="comment">//              vibrator.vibrate(pattern, -1);</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (lp.screenBrightness &lt; <span class="number">0.2</span>) &#123;</span><br><span class="line">        lp.screenBrightness = (<span class="keyword">float</span>) <span class="number">0.2</span>;</span><br><span class="line">        <span class="comment">//              vibrator = (Vibrator) getSystemService(VIBRATOR_SERVICE);</span></span><br><span class="line">        <span class="comment">//              long[] pattern = &#123;10, 200&#125;; // OFF/ON/OFF/ON...</span></span><br><span class="line">        <span class="comment">//              vibrator.vibrate(pattern, -1);</span></span><br><span class="line">    &#125;</span><br><span class="line">    getWindow().setAttributes(lp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜è®¾ç½®çš„å±å¹•äº®åº¦å€¼</span></span><br><span class="line">    <span class="comment">// Settings.System.putInt(getContentResolver(), Settings.System.SCREEN_BRIGHTNESS, (int) value);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½®å±å¹•äº®åº¦æ¨¡å¼æ–¹æ³• (è‡ªåŠ¨/æ‰‹åŠ¨)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// value å¯å–å€¼: Settings.System.SCREEN_BRIGHTNESS_MODE_AUTOMATIC / SCREEN_BRIGHTNESS_MODE_MANUAL</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setScreenMode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    Settings.System.putInt(getContentResolver(), Settings.System.SCREEN_BRIGHTNESS_MODE, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç›‘å¬æ’­æ”¾åŒºåŸŸ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mGestureDetector = <span class="keyword">new</span> GestureDetector(<span class="keyword">this</span>, mGestureListener);</span><br><span class="line">vv.setOnTouchListener(<span class="keyword">this</span>); </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouch</span><span class="params">(View v, MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mGestureDetector.onTouchEvent(event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>onScrollçš„æ—¶å€™åŠ¨æ€æ”¹å˜äº®åº¦<br><code>onDown()</code> / <code>onScroll()</code> è¿”å›true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> android.view.GestureDetector.OnGestureListener mGestureListener = <span class="keyword">new</span> GestureDetector.OnGestureListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDown</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShowPress</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onSingleTapUp</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onScroll</span><span class="params">(MotionEvent e1, MotionEvent e2, <span class="keyword">float</span> distanceX, <span class="keyword">float</span> distanceY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">double</span> FLING_MIN_VELOCITY = <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">double</span> FLING_MIN_DISTANCE = <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e1.getY() - e2.getY() &gt; FLING_MIN_DISTANCE</span><br><span class="line">                &amp;&amp; Math.abs(distanceY) &gt; FLING_MIN_VELOCITY) &#123;</span><br><span class="line">            setScreenBrightness(<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e1.getY() - e2.getY() &lt; FLING_MIN_DISTANCE</span><br><span class="line">                &amp;&amp; Math.abs(distanceY) &gt; FLING_MIN_VELOCITY) &#123;</span><br><span class="line">            setScreenBrightness(-<span class="number">20</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLongPress</span><span class="params">(MotionEvent e)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onFling</span><span class="params">(MotionEvent e1, MotionEvent e2, <span class="keyword">float</span> velocityX, <span class="keyword">float</span> velocityY)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="æ»‘åŠ¨ä¿®æ”¹éŸ³é‡"><a href="#æ»‘åŠ¨ä¿®æ”¹éŸ³é‡" class="headerlink" title="æ»‘åŠ¨ä¿®æ”¹éŸ³é‡"></a>æ»‘åŠ¨ä¿®æ”¹éŸ³é‡</h3><p>ä¿®æ”¹ä¸Šæ–¹çš„ <code>onScroll()</code> æ–¹æ³•,è°ƒç”¨ä»¥ä¸‹æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setVoiceVolume</span><span class="params">(<span class="keyword">boolean</span> volumeUp)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  è®¾ç½®éŸ³é‡ç»å¯¹å€¼çš„è¯,æˆ‘åœ¨å°ç±³ä¸Šçªç ´ä¸äº†é™åˆ¶,æœ€å¤§éŸ³é‡15,ä½†æ˜¯è®¾ç½®åˆ°10çš„æ—¶å€™å°±æ²¡æ³•å†å¢åŠ äº†,æœ€åä½¿ç”¨ç³»ç»Ÿçš„éŸ³é‡æ§åˆ¶æ‰å¯ä»¥</span></span><br><span class="line">    <span class="comment">//        int currentVolume = mAudioManager.getStreamVolume(AudioManager.STREAM_MUSIC);</span></span><br><span class="line">    <span class="comment">//        int maxVolume = mAudioManager.getStreamMaxVolume(AudioManager.STREAM_MUSIC);</span></span><br><span class="line">    <span class="comment">//        int flag = volumeUp ? 1 : -1;</span></span><br><span class="line">    <span class="comment">//        currentVolume += flag * 1;</span></span><br><span class="line">    <span class="comment">//        if (currentVolume &gt;= maxVolume) &#123;</span></span><br><span class="line">    <span class="comment">//            currentVolume = maxVolume;</span></span><br><span class="line">    <span class="comment">//        &#125; else if (currentVolume &lt;= 1) &#123;</span></span><br><span class="line">    <span class="comment">//            currentVolume = 1;</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line">    <span class="comment">//        Log.i(TAG, &quot;setVoiceVolume currentVolume = &quot; + currentVolume + &quot; ,maxVolume = &quot; + maxVolume);</span></span><br><span class="line">    <span class="comment">//        mAudioManager.setStreamVolume(AudioManager.STREAM_MUSIC, currentVolume, 0);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//é™ä½éŸ³é‡ï¼Œè°ƒå‡ºç³»ç»ŸéŸ³é‡æ§åˆ¶</span></span><br><span class="line">    <span class="keyword">if</span> (volumeUp) &#123;</span><br><span class="line">        mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC, AudioManager.ADJUST_RAISE,</span><br><span class="line">                AudioManager.FX_FOCUS_NAVIGATION_UP);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">//å¢åŠ éŸ³é‡ï¼Œè°ƒå‡ºç³»ç»ŸéŸ³é‡æ§åˆ¶</span></span><br><span class="line">        mAudioManager.adjustStreamVolume(AudioManager.STREAM_MUSIC, AudioManager.ADJUST_LOWER,</span><br><span class="line">                AudioManager.FX_FOCUS_NAVIGATION_UP);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨é¡µé¢å…³é—­æ—¶å¯è€ƒè™‘æ¢å¤äº®åº¦/éŸ³é‡åˆå§‹å€¼</li>
<li>åœ¨onTouchçš„æ—¶å€™å¯¹è§¦ç‚¹è¿›è¡Œåˆ¤æ–­,åŒºåˆ†æ˜¯ä¿®æ”¹éŸ³é‡æˆ–æ˜¯æ”¹å˜äº®åº¦</li>
</ul>
<h2 id="éœ€è¦å¤„ç†çš„é—®é¢˜"><a href="#éœ€è¦å¤„ç†çš„é—®é¢˜" class="headerlink" title="éœ€è¦å¤„ç†çš„é—®é¢˜"></a>éœ€è¦å¤„ç†çš„é—®é¢˜</h2><h3 id="æ‹–åŠ¨è¿›åº¦æ¡-æ‰‹åŠ¨seekToå-è¿›åº¦ä¼šè·³åŠ¨"><a href="#æ‹–åŠ¨è¿›åº¦æ¡-æ‰‹åŠ¨seekToå-è¿›åº¦ä¼šè·³åŠ¨" class="headerlink" title="æ‹–åŠ¨è¿›åº¦æ¡,æ‰‹åŠ¨seekToå,è¿›åº¦ä¼šè·³åŠ¨"></a>æ‹–åŠ¨è¿›åº¦æ¡,æ‰‹åŠ¨seekToå,è¿›åº¦ä¼šè·³åŠ¨</h3><p>æ–­ç‚¹è·Ÿè¸ªåå‘ç°æ˜¯nativeæ–¹æ³•çš„é—®é¢˜,å„å¤§è§†é¢‘æ’­æ”¾å¹³å°çš„å®¢æˆ·ç«¯,æ¯”è¾ƒæ™®éå­˜åœ¨,æš‚æ— æ³•å¤„ç†:<br><img src="https://user-gold-cdn.xitu.io/2017/12/27/16096ad6ded691ba?w=462&h=273&f=gif&s=1162341" alt="ä¼˜é…·å®¢æˆ·ç«¯æ—¶é—´è·³å˜"></p>
<p>æ‰¾åˆ°äº›èµ„æº:</p>
<ol>
<li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/f51b2febcfd2">å…³äºAndroid VideoView seekToä¸å‡†ç¡®çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/qingyuanluofeng/article/details/45375647">è§†é¢‘å…³é”®å¸§æå–</a><br>ç¬¬ä¸€ä¸ªæåˆ°çš„å…³é”®å¸§é—®é¢˜,æˆ‘æ‰¾äº†ä¸ªè§†é¢‘æµ‹è¯•äº†ä¸‹,seekToåˆ°å›ºå®šçš„æ—¶é—´ç‚¹,åˆ™è·³å˜çš„ä½ç½®ä¹Ÿå›ºå®š;</li>
</ol>
<h3 id="æš‚åœ-æ¢å¤-é¡µé¢æ—¶-è§†é¢‘é‡æ–°åŠ è½½"><a href="#æš‚åœ-æ¢å¤-é¡µé¢æ—¶-è§†é¢‘é‡æ–°åŠ è½½" class="headerlink" title="æš‚åœ/æ¢å¤ é¡µé¢æ—¶,è§†é¢‘é‡æ–°åŠ è½½"></a>æš‚åœ/æ¢å¤ é¡µé¢æ—¶,è§†é¢‘é‡æ–°åŠ è½½</h3><p>ç°è±¡: åœ¨è§†é¢‘æ’­æ”¾æ—¶,ä½¿é¡µé¢ <code>onPause()</code> ,ä¹‹åå†æ¢å¤,åˆ™ <code>videoView</code> ä¼šé‡æ–°å¼€å§‹æ’­æ”¾,ä¸´æ—¶çš„å¤„ç†æ–¹æ¡ˆæ˜¯åœ¨ <code>onPause()</code> çš„æ—¶å€™è®°å½•å½“å‰æ’­æ”¾è¿›åº¦ä½ç½®,åœ¨ <code>onResume()</code> çš„æ—¶å€™æ‹–åŠ¨åˆ°è¯¥è¿›åº¦ä½ç½®,ä½†æ˜¯è¯¥æ–¹æ¡ˆä»ä¼šæœ‰é»‘å±ç°è±¡,ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> mPlayingPos = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mPlayingPos = mVideoView.getCurrentPosition(); <span class="comment">//å…ˆè·å–å†stopPlay(),åŸå› è‡ªå·±çœ‹æºç </span></span><br><span class="line">    mVideoView.stopPlayback();</span><br><span class="line">    <span class="keyword">super</span>.onPause();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mPlayingPos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//æ­¤å¤„ä¸ºæ›´å¥½çš„ç”¨æˆ·ä½“éªŒ,å¯æ·»åŠ ä¸€ä¸ªprogressBar,æœ‰äº›å®¢æˆ·ç«¯ä¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éšè—åº•ä¸‹æ§åˆ¶æ ,è¿™æ–¹æ³•ä¹Ÿä¸é”™</span></span><br><span class="line">        mVideoView.start();</span><br><span class="line">        mVideoView.seekTo(mPlayingPos);</span><br><span class="line">        mPlayingPos = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.onResume();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ°äº›å¯èƒ½ç›¸å…³çš„æ–‡ç« ,é“¾æ¥å·²å¤±æ•ˆ,å¿«ç…§å¦‚ä¸‹(è¿˜å¾—å»çœ‹çœ‹ <code>surfaceView</code> å•Š ~ ~# ):<br>å¦ä¸€ç¯‡ç±»ä¼¼çš„: <a target="_blank" rel="noopener" href="http://www.boyunjian.com/do/article/snapshot.do?uid=3453185252600635258">androidå¼€å‘å¸¸è§é—®é¢˜</a> é—®é¢˜7,ä¹ŸæŒ‡æ˜æ˜¯ <code>surfaceview</code> çš„åŸå› ,ä¹‹æ‰€ä»¥æ˜¯é»‘è‰²çš„è§åé¢çš„è§£é‡Š:</p>
<blockquote>
<p>Activity è°ƒç”¨çš„é¡ºåºæ˜¯ onPause() -&gt; onStop()<br>SurfaceView è°ƒç”¨äº† surfaceDestroyed() æ–¹æ³•<br>ç„¶åå†åˆ‡å›ç¨‹åº<br>Activity è°ƒç”¨çš„é¡ºåºæ˜¯ onRestart() -&gt; onStart() -&gt; onResume ()<br>SurfaceView` è°ƒç”¨äº† surfaceChanged() -&gt; surfaceCreated() æ–¹æ³•<br>æŒ‰æŒ‚æ–­é”®æˆ–é”å®šå±å¹•<br>Activity åªè°ƒç”¨ onPause() æ–¹æ³•<br>è§£é”å Activity è°ƒç”¨ onResume() æ–¹æ³•<br>SurfaceView ä»€ä¹ˆæ–¹æ³•éƒ½ä¸è°ƒç”¨ </p>
</blockquote>
<h3 id="ç½‘ç»œå˜åŒ–-åˆ‡æ¢åº”ç”¨åæ¢å¤æ’­æ”¾"><a href="#ç½‘ç»œå˜åŒ–-åˆ‡æ¢åº”ç”¨åæ¢å¤æ’­æ”¾" class="headerlink" title="ç½‘ç»œå˜åŒ–/åˆ‡æ¢åº”ç”¨åæ¢å¤æ’­æ”¾"></a>ç½‘ç»œå˜åŒ–/åˆ‡æ¢åº”ç”¨åæ¢å¤æ’­æ”¾</h3><p>æ’­æ”¾è¿‡ç¨‹ä¸­,å‡å¦‚åªç¼“å†²äº†ä¸€éƒ¨åˆ†è§†é¢‘,åˆ™å½“æ’­æ”¾å®Œç¼“å†²éƒ¨åˆ†å,ä¼šæŠ›å‡º1004å¼‚å¸¸,å³ä½¿æ­¤æ—¶ç½‘ç»œè¿æ¥å·²ç»æ¢å¤,æ§ä»¶ä¹Ÿä¸ä¼šè‡ªåŠ¨ç»§ç»­ç¼“å†²:<br><code>MediaPlayer: error (1, -1004)</code><br>æºç æ³¨é‡Š: <code>File or network related operation errors</code><br>åŒæ—¶,ç”±äºSurfaceViewåœ¨é¡µé¢onStop()æ—¶ä¼šdestroy,æ¯”å¦‚æ’­æ”¾æ—¶,ç”¨æˆ·æŒ‰ä¸‹homeé”®æˆ–åˆ‡æ¢åˆ°å…¶ä»–åº”ç”¨é¡µé¢å†è¿”å›æ—¶,è§†é¢‘æ’­æ”¾åœæ­¢,æ­¤æ—¶éœ€è¦é‡æ–°åŠ è½½è§†é¢‘å¹¶æ’­æ”¾åˆ°ä¸Šæ¬¡åœæ­¢çš„ä½ç½®;</p>
<p>å¦å¤–,æœ‰æµ‹è¯•å‘ç°åœ¨ä¸‰æ˜ŸG9200æ‰‹æœºä¸Š,æŠ¥ <code>1004</code> è¿™ä¸ªé”™çš„æ—¶å€™ä¼šå¼¹å‡ºé”™è¯¯æç¤ºæ¡†,ç„¶åå¡æ­»é‡å¯â€¦<br>å¯¹æ¯”äº†ä¸‹æ—¥å¿—:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// API23 MediaPlayer.java</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mMediaPlayer.mNativeContext == <span class="number">0</span>) &#123;</span><br><span class="line">        Log.w(TAG, <span class="string">&quot;mediaplayer went away with unhandled events&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span>(msg.what) &#123;</span><br><span class="line">        <span class="keyword">case</span> MEDIA_ERROR:</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;Error (&quot;</span> + msg.arg1 + <span class="string">&quot;,&quot;</span> + msg.arg2 + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">        <span class="keyword">boolean</span> error_was_handled = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (mOnErrorListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">            error_was_handled = mOnErrorListener.onError(mMediaPlayer, msg.arg1, msg.arg2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mOnCompletionListener != <span class="keyword">null</span> &amp;&amp; ! error_was_handled) &#123;</span><br><span class="line">            mOnCompletionListener.onCompletion(mMediaPlayer);</span><br><span class="line">        &#125;</span><br><span class="line">        stayAwake(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;Unknown message type &quot;</span> + msg.what);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//API23 VideoView.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnErrorListener</span><span class="params">(OnErrorListener l)</span></span>&#123;</span><br><span class="line">    mOnErrorListener = l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> MediaPlayer.OnErrorListener mErrorListener =</span><br><span class="line">    <span class="keyword">new</span> MediaPlayer.OnErrorListener() &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onError</span><span class="params">(MediaPlayer mp, <span class="keyword">int</span> framework_err, <span class="keyword">int</span> impl_err)</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If an error handler has been supplied, use it and finish. */</span></span><br><span class="line">        <span class="keyword">if</span> (mOnErrorListener != <span class="keyword">null</span>) &#123; <span class="comment">//å¦‚æœè¿™é‡Œæ²¡æœ‰å¤„ç†,åˆ™æ¯æ¬¡å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šå¼¹å‡ºæç¤ºæ¡†,å¯èƒ½é€ æˆå´©æºƒ</span></span><br><span class="line">            <span class="keyword">if</span> (mOnErrorListener.onError(mMediaPlayer, framework_err, impl_err)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Otherwise, pop up an error dialog so the user knows that</span></span><br><span class="line"><span class="comment">            * something bad has happened. Only try and pop up the dialog</span></span><br><span class="line"><span class="comment">            * if we&#x27;re attached to a window. When we&#x27;re going away and no</span></span><br><span class="line"><span class="comment">            * longer have a window, don&#x27;t bother showing the user an error.</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">        <span class="keyword">if</span> (getWindowToken() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Resources r = mContext.getResources();</span><br><span class="line">            <span class="keyword">int</span> messageId;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (framework_err == MediaPlayer.MEDIA_ERROR_NOT_VALID_FOR_PROGRESSIVE_PLAYBACK) &#123;</span><br><span class="line">                messageId = com.android.internal.R.string.VideoView_error_text_invalid_progressive_playback;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                messageId = com.android.internal.R.string.VideoView_error_text_unknown;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¼¹å‡ºé”™è¯¯æç¤ºæ¡†</span></span><br><span class="line">            <span class="keyword">new</span> AlertDialog.Builder(mContext)</span><br><span class="line">                    .setMessage(messageId)</span><br><span class="line">                    .setPositiveButton(com.android.internal.R.string.VideoView_error_button,</span><br><span class="line">                            <span class="keyword">new</span> DialogInterface.OnClickListener() &#123;</span><br><span class="line">                                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> whichButton)</span> </span>&#123;</span><br><span class="line">                                    <span class="comment">/* If we get here, there is no onError listener, so</span></span><br><span class="line"><span class="comment">                                        * at least inform them that the video is over.</span></span><br><span class="line"><span class="comment">                                        */</span></span><br><span class="line">                                    <span class="keyword">if</span> (mOnCompletionListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                        mOnCompletionListener.onCompletion(mMediaPlayer);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                    .setCancelable(<span class="keyword">false</span>)</span><br><span class="line">                    .show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å› æ­¤éœ€è¦å¯¹ç½‘ç»œå˜åŒ–è¿›è¡Œç›‘å¬:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onResume();</span><br><span class="line">    mNetworkState = NetworkHelper.getNetworkType(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//æ’­æ”¾ç½‘ç»œè§†é¢‘æ—¶,éœ€è¦æ£€æµ‹åˆ¤æ–­ç½‘ç»œçŠ¶æ€å˜åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (SCHEME_HTTP.equalsIgnoreCase(mVideoUri.getScheme()) &amp;&amp; mNetworkState == <span class="number">0</span>) &#123;</span><br><span class="line">        MessageUtils.showAlertDialog(<span class="keyword">this</span>, <span class="string">&quot;æç¤º&quot;</span>, getResources().getString(R.string.network_error), <span class="keyword">null</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mPlayingPos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            mVv.start();</span><br><span class="line">            mVv.seekTo(mPlayingPos);</span><br><span class="line">            mPlayingPos = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘å¬ç½‘ç»œå˜åŒ–,ç”¨äºé‡æ–°ç¼“å†²</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">registerNetworkReceiver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mNetworkReceiver == <span class="keyword">null</span>) &#123;</span><br><span class="line">        mNetworkReceiver = <span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line">                String action = intent.getAction();</span><br><span class="line">                <span class="keyword">if</span> (SCHEME_HTTP.equalsIgnoreCase(mVideoUri.getScheme())</span><br><span class="line">                            &amp;&amp; action.equalsIgnoreCase(ConnectivityManager.CONNECTIVITY_ACTION)) &#123;</span><br><span class="line">                    doWhenNetworkChange();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    registerReceiver(mNetworkReceiver, <span class="keyword">new</span> IntentFilter(ConnectivityManager.CONNECTIVITY_ACTION));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç½‘ç»œæ’­æ”¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doWhenNetworkChange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mNetworkState = NetworkHelper.getNetworkType(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//ä¿å­˜å½“å‰å·²ç¼“å­˜é•¿åº¦</span></span><br><span class="line">    <span class="keyword">int</span> bufferPercentage = mVv.getBufferPercentage();</span><br><span class="line">    mLastLoadLength = bufferPercentage * mVv.getDuration() / <span class="number">100</span>;</span><br><span class="line">    <span class="comment">//è¿™é‡Œéœ€è¦åˆ¤æ–­ 0</span></span><br><span class="line">    <span class="keyword">int</span> currentPosition = mVv.getCurrentPosition();</span><br><span class="line">    <span class="keyword">if</span> (currentPosition &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        mPlayingPos = currentPosition;</span><br><span class="line">    &#125;</span><br><span class="line">    debugLog(bufferPercentage + <span class="string">&quot; ç½‘ç»œå˜åŒ– ... &quot;</span> + mNetworkState + <span class="string">&quot; ç¼“å­˜é•¿åº¦ &quot;</span> + mLastLoadLength + <span class="string">&quot; -- &quot;</span> + currentPosition);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mNetworkState == NetworkHelper.NETWORK_TYPE_INVALID &amp;&amp; bufferPercentage &lt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="comment">// ç›‘å¬å½“å‰æ’­æ”¾ä½ç½®,åœ¨è¾¾åˆ°ç¼“å†²é•¿åº¦å‰è‡ªåŠ¨åœæ­¢</span></span><br><span class="line">        <span class="keyword">if</span> (mCheckPlayingProgressTimer == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mCheckPlayingProgressTimer = <span class="keyword">new</span> Timer();</span><br><span class="line">        &#125;</span><br><span class="line">        mCheckPlayingProgressTimer.schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (mPlayingPos &gt;= mLastLoadLength - deltaTime) &#123;</span><br><span class="line">                    mVv.pause();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">1000</span>);<span class="comment">//æ¯ç§’æ£€æµ‹ä¸€æ¬¡</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        restartPlayVideo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">restartPlayVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//todo æ·»åŠ  progressBar ä½“éªŒå¥½ç‚¹</span></span><br><span class="line">    <span class="keyword">if</span> (mCheckPlayingProgressTimer != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mCheckPlayingProgressTimer.cancel();</span><br><span class="line">        mCheckPlayingProgressTimer = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mVv.setVideoURI(mVideoUri);</span><br><span class="line">    mVv.start();</span><br><span class="line">    mVv.seekTo(mPlayingPos);</span><br><span class="line"></span><br><span class="line">    mLastLoadLength = -<span class="number">1</span>;</span><br><span class="line">    mPlayingPos = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mPlayingPos = mVv.getCurrentPosition();</span><br><span class="line">    mVv.pause();</span><br><span class="line">    <span class="keyword">super</span>.onPause();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    mVv.stopPlayback();</span><br><span class="line">    mLastLoadLength = <span class="number">0</span>;</span><br><span class="line">    debugLog(<span class="string">&quot;onResume &quot;</span> + mPlayingPos + <span class="string">&quot; -- &quot;</span> + mLastLoadLength);</span><br><span class="line">    <span class="keyword">super</span>.onStop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (mCheckPlayingProgressTimer != <span class="keyword">null</span>) &#123;</span><br><span class="line">        mCheckPlayingProgressTimer.cancel();</span><br><span class="line">        mCheckPlayingProgressTimer = <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ......</span><br><span class="line">    unregisterNetworkReceiver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="seekbarå˜åŒ–è¶…å‡ºç¼“å†²é•¿åº¦"><a href="#seekbarå˜åŒ–è¶…å‡ºç¼“å†²é•¿åº¦" class="headerlink" title="seekbarå˜åŒ–è¶…å‡ºç¼“å†²é•¿åº¦"></a>seekbarå˜åŒ–è¶…å‡ºç¼“å†²é•¿åº¦</h3><p>ä½¿ç”¨ç³»ç»Ÿæä¾›çš„æ§ä»¶ <code>mVv.setMediaController(new MediaController(this));</code> çš„è¯,åœ¨æ–­ç½‘æ—¶,ä»å¯ä»¥æ‹–åŠ¨è¶…å‡ºç¼“å†²é•¿åº¦çš„èŒƒå›´,ä¼šæŠ¥é”™,è¿™ä¸ªè¿˜æ˜¯å¾—è‡ªå®šä¹‰æ‰èƒ½æ§åˆ¶å¯æ‹–åŠ¨ä½ç½®,ä¸å†èµ˜è¿°;</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MediaPlayer: Attempt to perform seekTo in wrong state: mPlayer=0x7f7ebbf5c0, mCurrentState=0</span><br><span class="line">MediaPlayer: Error (1,-1004)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//API 23 MediaController.java</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> OnSeekBarChangeListener mSeekListener = <span class="keyword">new</span> OnSeekBarChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressChanged</span><span class="params">(SeekBar bar, <span class="keyword">int</span> progress, <span class="keyword">boolean</span> fromuser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!fromuser) &#123;</span><br><span class="line">            <span class="comment">// We&#x27;re not interested in programmatically generated changes to</span></span><br><span class="line">            <span class="comment">// the progress bar&#x27;s position.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è¿™é‡Œå°±åªæ˜¯è®¾å®šmediaplayerçš„æ’­æ”¾ä½ç½®è€Œå·²</span></span><br><span class="line">        <span class="keyword">long</span> duration = mPlayer.getDuration();</span><br><span class="line">        <span class="keyword">long</span> newposition = (duration * progress) / <span class="number">1000L</span>;</span><br><span class="line">        mPlayer.seekTo( (<span class="keyword">int</span>) newposition);</span><br><span class="line">        <span class="keyword">if</span> (mCurrentTime != <span class="keyword">null</span>)</span><br><span class="line">            mCurrentTime.setText(stringForTime( (<span class="keyword">int</span>) newposition));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æ–­ç½‘å,ç”¨æˆ·æ‹–åŠ¨è¶…å‡ºç¼“å†²åŒºé•¿åº¦çš„è¯mediaplayeræŠ¥é”™,æ­¤æ—¶å†æ¬¡ç‚¹å‡»VideoViewåŒºåŸŸ,ä¸ä¼šè§¦å‘æ˜¾ç¤ºæ§åˆ¶æ¡,çœŸæ˜¯å„ç§ä¸æ–¹ä¾¿å•Š,è¿˜æ˜¯å»ºè®®è‡ªå·±å†™ä¸€ä¸ªæ§åˆ¶æ¡;</p>
<h1 id="SurfaceView"><a href="#SurfaceView" class="headerlink" title="SurfaceView"></a>SurfaceView</h1><h2 id="èµ„æº-1"><a href="#èµ„æº-1" class="headerlink" title="èµ„æº"></a>èµ„æº</h2><ol>
<li><a target="_blank" rel="noopener" href="http://tech.youzan.com/surfaceview-sourcecode/">SurfaceView æºç åˆ†æåŠä½¿ç”¨</a><br>è¿™ç¯‡è®²åˆ°äº† <code>SurfaceView</code> ä¼šæ˜¾ç¤ºé»‘è‰²åŒºåŸŸçš„åŸå› :<blockquote>
<p>SurfaceView çš„ draw å’Œ dispatchDraw æ–¹æ³•ä¸­çœ‹åˆ°ï¼ŒSurfaceView ä¸­ï¼ŒwindownTypeå˜é‡è¢«åˆå§‹åŒ–ä¸ºWindowManager.LayoutParams.TYPE_APPLICATION_MEDIAï¼Œæ‰€ä»¥åœ¨åˆ›å»ºç»˜åˆ¶è¿™ä¸ª View çš„è¿‡ç¨‹ä¸­æ•´ä¸ª Canvas ä¼šè¢«æ¶‚æˆé»‘è‰²</p>
</blockquote>
</li>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/Hello__Zero/article/details/42389197">æµ®å±‚è§†é¢‘æ•ˆæœ,åœ¨å¦å¤–ä¸€ä¸ªWindowä½¿ç”¨SurfaceViewæ— æ³•æ­£å¸¸æ˜¾ç¤ºçš„é—®é¢˜æ’æŸ¥ä¸è§£å†³</a></li>
</ol>
<h2 id="surfaceViewé»‘å±"><a href="#surfaceViewé»‘å±" class="headerlink" title="surfaceViewé»‘å±"></a>surfaceViewé»‘å±</h2><ol>
<li><p>æ— å†…å®¹æ—¶,é»˜è®¤ä¼šç»˜åˆ¶é»‘è‰²èƒŒæ™¯å›¾</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SurfaceView.java</span></span><br><span class="line"><span class="keyword">int</span> mWindowType = WindowManager.LayoutParams.TYPE_APPLICATION_MEDIA;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mWindowType != WindowManager.LayoutParams.TYPE_APPLICATION_PANEL) &#123;</span><br><span class="line">        <span class="comment">// draw() is not called when SKIP_DRAW is set</span></span><br><span class="line">        <span class="keyword">if</span> ((mPrivateFlags &amp; PFLAG_SKIP_DRAW) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// punch a whole in the view-hierarchy below us</span></span><br><span class="line">            canvas.drawColor(<span class="number">0</span>, PorterDuff.Mode.CLEAR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">super</span>.draw(canvas);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè°¢<a target="_blank" rel="noopener" href="http://www.jianshu.com/users/ce0ae357d9bb">@å°šå¼Ÿå¾ˆå¿™å“’</a>Â çš„æé†’, è®¾ç½®é¡µé¢ä¸»é¢˜ä¸ºé€æ˜(<code>android:theme=&quot;@android:style/Theme.Translucent&quot;</code>)æ—¶,åœ¨åˆå§‹ç¼“å†²é˜¶æ®µ,VideoViewåŒºåŸŸä¼šå˜æˆé€æ˜:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;org.lynxz.androiddemos.VideoViewActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;200dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:background</span>=<span class="string">&quot;@android:color/holo_blue_bright&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">VideoView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/vv&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_centerInParent</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨SurfaceViewç±»å¼€å¤´æœ‰é…±ç´«çš„ä¸€æ®µæ³¨é‡Š,å¤§æ¦‚èƒ½è§£é‡Šä¸ºä»€ä¹ˆç¼“å†²æ—¶å€™è§†é¢‘åŒºåŸŸä¼šé€æ˜äº†:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The surface is Z ordered so that it is behind the window holding its SurfaceView; </span><br><span class="line">the SurfaceView punches a hole in its window to allow its surface to be displayed.</span><br></pre></td></tr></table></figure>
<p>å› æ­¤å¤„ç†æ–¹æ¡ˆå°±å˜æˆå°†SurfaceViewæŒªåˆ°ä¸Šå±‚å³å¯:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mVv.setZOrderOnTop(<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡æŒªåŠ¨ä¹‹åå°±å¯ä»¥è®¾ç½®VideoViewçš„èƒŒæ™¯,æ­¤æ—¶æ‰ä¸ä¼šé®ç›–å®é™…çš„è§†é¢‘ç»˜å›¾äº†,xmlä¸­æŒ‡å®šå§,è¿™é‡Œçœç•¥,ä¸è¿‡å¦‚æœVideoViewåŒºåŸŸè¿˜æœ‰å…¶ä»–æ§ä»¶çš„è¯,ä¼šè¢«é®ç›–,æ‰€ä»¥æœ€åæˆ‘å°±æ²¡è®¾å®šzorderOnTopäº†,è€Œæ˜¯ç›´æ¥åœ¨xmlä¸­æŒ‡å®šVideoViewçš„èƒŒæ™¯è‰²,ç„¶ååœ¨onPrepareå›è°ƒçš„æ—¶å€™,å»æ‰èƒŒæ™¯å³å¯(æŒ‰éœ€å»¶æ—¶,æˆ–è€…åœ¨æœ‰æ’­æ”¾è¿›åº¦,è¦æ›´æ–°è¿›åº¦æ¡çš„æ—¶å€™è¿›è¡Œå»æ‰èƒŒæ™¯æ“ä½œéƒ½ok,ä¸ç„¶å¯èƒ½ä¼šæœ‰ä¸€ç¬é—´çš„é€æ˜):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mVv.setBackgroundColor(Color.TRANSPARENT);</span><br></pre></td></tr></table></figure>
<p>ä¹‹å‰æ˜¯æ‰“ç®—åƒç½‘ä¸Šè¯´çš„ç»™VideoViewçš„holderæ·»åŠ ä¸€ä¸ªcallback,(<code>mVv.getHolder().addCallback(new SurfaceHolder.Callback() &#123;...&#125;</code>) ,åœ¨ <code>surfaceCreated()</code> çš„æ—¶å€™è·å–canvaså¹¶æ‰‹åŠ¨ç»˜åˆ¶èƒŒæ™¯è‰²,ä½†æ˜¯ <code>holder.lockCanvas()</code> ä¸€ç›´è¿”å› <code>null</code> ,logä¿¡æ¯æç¤º:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E&#x2F;SurfaceHolder: Exception locking surface</span><br><span class="line">                           java.lang.IllegalArgumentException</span><br><span class="line">                           at android.view.Surface.nativeLockCanvas(Native Method)</span><br><span class="line">                            .......</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°nativeæˆ‘æš‚æ—¶å°±æ²¡æ‹›äº†,æ‰“ä½,è€å®ç”¨å˜é€šæ–¹æ³•å§;</p>
</li>
<li><p>æ‰‹æœº â€œèœå•é”®â€ å¯¼è‡´åº”ç”¨è¢«stop,è™½ç„¶æ­¤æ—¶çœ‹èµ·æ¥å¯è§<br><code>SurfaceView.java</code>   çš„æ³¨é‡Š: åœ¨è°ƒç”¨èœå•é”®çš„æ—¶å€™è™½ç„¶é¡µé¢è²Œä¼¼å¯è§,ä½†å®é™…å·²ç»è°ƒç”¨äº†onStop()æ–¹æ³•äº†,è€Œsurfaceåœ¨windowä¸å¯è§æ—¶ä¼šé”€æ¯:</p>
<blockquote>
<p>The Surface will be created for you while the SurfaceViewâ€™s window is<br>visible; you should implement {@link SurfaceHolder.Callback#surfaceCreated}<br>and {@link SurfaceHolder.Callback#surfaceDestroyed} to discover when the<br>Surface is created and destroyed as the window is shown and hidden.</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2017/12/27/16096ad6e9b31984?w=356&h=645&f=gif&s=1471630" alt=" æŒ‰ä¸‹èœå•é”®åè¿”å›"></p>
</li>
<li><p>VideoViewæ— æ³•æ’­æ”¾f4væ ¼å¼(ä¸‰æ˜Ÿs6å¯ä»¥æ’­æ”¾,çº¢ç±³1s(4.4.4)æ’­æ”¾å¤±è´¥)â€¦.<br>ä»¥åèƒ½åŠ›å¤Ÿäº†å¯ä»¥å‚è€ƒä¸‹è¿™ç¯‡ :     </p>
<ul>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/bonderwu/article/details/6261798">Androidå¹³å°Stagefrightä¸­å¢åŠ flv/f4væ”¯æŒåŠç›¸å…³åŸç†ä»‹ç»</a></li>
<li><a target="_blank" rel="noopener" href="http://www.iaeej.com/xxydzgc/ch/reader/create_pdf.aspx?file_no=20130512&year_id=2013&quarter_id=5&falg=1">StagefrightåŠŸèƒ½æ‰©å±•</a> è¿™ç¯‡è®ºæ–‡å‰åŠéƒ¨åˆ†æœ‰å…³äºå¤šåª’ä½“æ¡†æ¶è°ƒç”¨çš„ä»‹ç»</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/24/VideoView-md/" data-id="ckgn2xkfy0002qxwd7vpp2g17" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/10/24/%E5%BA%94%E8%AF%A5%E4%BB%8EAPI15%E8%BF%98%E6%98%AF14%E5%BC%80%E5%A7%8B%E6%94%AF%E6%8C%81-md/">åº”è¯¥ä»API15è¿˜æ˜¯14å¼€å§‹æ”¯æŒ.md</a>
          </li>
        
          <li>
            <a href="/2020/10/24/LifeCycle%E8%A7%A3%E6%9E%90-md/">LifeCycleè§£æ.md</a>
          </li>
        
          <li>
            <a href="/2020/10/24/VideoView-md/">VideoView.md</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>